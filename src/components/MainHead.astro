---
import ogImageAsset from "@/assets/og-image.jpg";
const ogImage = new URL(ogImageAsset.src, Astro.site).toString();

// Font configuration - change this to try different fonts
// FONT_FAMILY: The actual font name (with spaces) for CSS
// FONT_FAMILY_URL: The font name for Google Fonts URL (use + for spaces)
// Examples: 
//   - Nunito: FONT_FAMILY="Nunito", FONT_FAMILY_URL="Nunito"
//   - Work Sans: FONT_FAMILY="Work Sans", FONT_FAMILY_URL="Work+Sans"
//   - Space Grotesk: FONT_FAMILY="Space Grotesk", FONT_FAMILY_URL="Space+Grotesk"
const FONT_FAMILY = "Nunito";
const FONT_FAMILY_URL = "Nunito";
const FONT_WEIGHTS = "400;700";

interface Props {
	title?: string | undefined;
	description?: string | undefined;
}

const { title = "Daniel Ives", description = "Software Engineer" } =
	Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);

const siteURL = new URL('https://daniel-ives.com');

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "Daniel Ives",
  "url": siteURL.toString(),
  "description": description,
  "email": "contact@daniel-ives.com",
  "jobTitle": "Software Engineer",
  "worksFor": {
    "@type": "Organization",
    "name": "Bamboo Rose"
  },
  "sameAs": [
    "https://github.com/daives01"
  ]
};

// Construct inline CSS with font family and critical styles
const inlineCss = `
  html {
    scrollbar-gutter: stable;
    visibility: hidden;
  }
  html.css-loaded {
    visibility: visible;
  }
  body {
    background-color: #f9fafb;
    color: #000000;
    line-height: 1.75rem;
    font-family: '${FONT_FAMILY}', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    margin: 0;
  }
  @media (prefers-color-scheme: dark) {
    body {
      background-color: #171717;
      color: #ffffff;
    }
  }
  a {
    text-decoration: underline;
  }
  a:hover {
    text-decoration: none;
  }
`;
---
<meta charset="UTF-8" />
<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<meta name="description" property="og:description" content={description} />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="generator" content={Astro.generator} />

<link rel="canonical" href={canonicalURL} />

<title>{title}</title>

<meta name="description" content={description} />

<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:type" content="website" />
<meta property="og:url" content={canonicalURL} />
<meta property="og:image" content={ogImage} />
<meta property="og:site_name" content="Daniel Ives" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImage} />

<script type="application/ld+json" is:inline set:html={JSON.stringify(jsonLd)} />
<!-- Critical inline CSS - ensures styles apply immediately during navigation -->
<style is:global set:html={inlineCss}></style>
<!-- Prevent FOUC by showing content only after styles load -->
<script is:inline>
  (function() {
    // Show content once DOM is ready and styles are loaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        document.documentElement.classList.add('css-loaded');
      });
    } else {
      // DOM already loaded
      document.documentElement.classList.add('css-loaded');
    }
  })();
</script>
<!-- Preconnect to Google Fonts for faster font loading -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<!-- Load font stylesheet with block display to prevent font swap and layout shift -->
<!-- font-display: block waits for font to load (up to 3s) before showing text, preventing layout shift -->
<!-- This ensures Nunito is used from the start, avoiding any content movement when font loads -->
<link href={`https://fonts.googleapis.com/css2?family=${FONT_FAMILY_URL}:wght@${FONT_WEIGHTS}&display=block`} rel="stylesheet" />
 <!-- Prefetch about page image (Astro's prefetch handles pages automatically) -->
<link rel="prefetch" href={ogImageAsset.src} as="image" />
